<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>김선경 - TodoList</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Pretendard", "Noto Sans KR", sans-serif;
      }
      html,
      body {
        height: 100%;
        background-color: #fff8f2;
        color: #333;
      }
      #wrap {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 40px 16px;
        min-height: 100%;
      }
      #container {
        width: 100%;
        max-width: 720px;
        padding: 36px 28px;
        border-radius: 16px;
        background-color: #fff;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.13);
      }
      .title {
        margin-bottom: 24px;
        font-size: 26px;
        font-weight: bold;
        text-align: center;
        color: #333;
      }
      .my-status {
        display: grid;
        grid-template-columns: 80px 1fr;
        gap: 12px 10px;
        margin-bottom: 28px;
        padding: 20px;
        font-size: 15px;
        color: #333;
        background-color: #ffe8d9;
        border-radius: 12px;
      }
      .my-status dd {
        margin-bottom: 0;
      }
      .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 24px;
      }
      .search-box input {
        flex: 1;
        font-size: 14px;
      }
      .search-box input::placeholder {
        color: #bbb;
      }
      .search-box button {
        padding: 12px 16px;
        background-color: #ff5e2b;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s ease;
      }
      .search-box button:hover {
        background-color: #f4511e;
      }
      .btn-box {
        padding-top: 20px;
        border-top: 1px solid #e7e7e7;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      .btn-box .btn {
        padding: 8px 14px;
        font-size: 13px;
        background-color: #ffe0d3;
        color: #d84315;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .btn-box .btn:hover {
        background-color: #ffccbc;
      }
      .table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      .table th,
      .table td {
        padding: 12px 8px;
        border-bottom: 1px solid #e7e7e7;
        text-align: center;
        vertical-align: middle;
      }
      .table tbody tr:hover {
        background-color: #fff3e0;
      }
      input[type="checkbox"] {
        transform: scale(1.1);
        accent-color: #ff7043;
        cursor: pointer;
      }
      .item-confirm {
        color: #bbb;
        text-decoration: line-through;
      }
    </style>
  </head>
  <body>
    <div id="wrap">
      <main id="container">
        <h1 class="title">To-do List</h1>

        <dl class="my-status">
          <dt>할 일</dt>
          <dd id="new-work"></dd>
          <dt>한 일</dt>
          <dd id="finish-work"></dd>
          <dt>달성률</dt>
          <dd id="finish-percent"></dd>
        </dl>

        <!-- search -->
        <section class="search-box">
          <input
            type="text"
            id=""
            name=""
            class="form-control"
            placeholder="내용을 입력하세요"
            onkeydown="enterKey(event);"
          />
          <button type="button" class="btn btn-primary" onclick="renderList();">
            등록
          </button>
        </section>

        <!-- button -->
        <section
          class="btn-box d-flex align-items-center justify-content-end gap-1 mt-4"
        >
          <button
            type="button"
            class="btn btn-sm btn-secondary"
            onclick="confirmListAll();"
            disabled
          >
            일괄완료
          </button>
          <button
            type="button"
            class="btn btn-sm btn-secondary"
            onclick="deleteListAll();"
            disabled
          >
            일괄삭제
          </button>
        </section>

        <!-- list -->
        <section class="list-box mt-2">
          <table class="table small text-center">
            <colgroup>
              <col width="10%" />
              <col width="*" />
              <col width="15%" />
              <col width="15%" />
            </colgroup>
            <thead class="table-dark">
              <tr>
                <th>
                  <input
                    type="checkbox"
                    id="chkAll"
                    name="chk"
                    onchange="toggleChkAll(this.checked);"
                  />
                </th>
                <th>내용</th>
                <th>완료</th>
                <th>삭제</th>
              </tr>
            </thead>
            <tbody id="table-tbody">
              <!-- innerHTML js -->
            </tbody>
          </table>
        </section>
      </main>
    </div>
  </body>

  <script>
    const tbody = document.querySelector("#table-tbody");

    // 일괄완료/삭제 버튼 disabled status
    function statusBtn() {
      const trs = tbody.querySelectorAll("tr");
      const btns = document.querySelectorAll(".btn-box .btn");
      btns.forEach((item) => {
        if (trs.length === 0) {
          item.disabled = true;
        } else {
          item.disabled = false;
        }
      });
    }

    // list 추가
    let count = 0;
    function renderList() {
      const input = document.querySelector('input[type="text"]');
      if (input.value.trim().length !== 0) {
        count += 1;
        tbody.innerHTML += `
      <tr>
        <td><input type="checkbox" id="chk-${count}" name="chk" onchange="undateCheckbox();" /></td> 
        <td><span>${input.value}</span></td>    
        <td><button type="button" class="btn btn-sm btn-outline-success" data-id="btn-confirm" onclick="confirmList(this);">완료</td>
        <td><button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteList(this);">삭제</td>
      </tr>
    `;
        input.value = "";
        input.focus();

        document.querySelector("#new-work").textContent = `${count}건`;

        statusBtn();
        renderCalc();
      } else {
        alert("내용을 입력해주세요.");
        return;
      }
    }

    // 완료
    let finishCount = 0;
    function confirmList(target) {
      const targetList = target.closest("tr");
      targetList.querySelector("span").classList.add("item-confirm");

      const finishBtn = targetList.querySelector('[data-id="btn-confirm"]');
      if (finishBtn) finishBtn.disabled = true;

      finishCount += 1;
      count -= 1;
      renderCalc();
    }

    // 일괄 완료
    function confirmListAll() {
      const checkedItems = document.querySelectorAll(
        'table td input[name="chk"]:checked'
      );
      checkedItems.forEach((item) => {
        const parentTr = item.closest("tr");
        const span = parentTr.querySelector("span");
        if (!span.classList.contains("item-confirm")) confirmList(item);
      });
    }

    // 삭제
    function deleteList(target) {
      const targetList = target.closest("tr");
      const isFinished = targetList
        .querySelector("span")
        .classList.contains("item-confirm");
      isFinished ? (finishCount -= 1) : (count -= 1);
      targetList.remove();
      renderCalc();
      if (count === 0 && finishCount === 0)
        document.querySelector("#chkAll").checked = false;
    }

    // 일괄 삭제
    function deleteListAll() {
      const checkedItems = document.querySelectorAll(
        'table td input[name="chk"]:checked'
      );
      checkedItems.forEach((item) => {
        const parentTr = item.closest("tr");
        if (parentTr) deleteList(item);
      });
    }

    // 계산
    function renderCalc() {
      statusBtn();

      count = Math.max(0, count);
      finishCount = Math.max(0, finishCount);

      document.querySelector("#new-work").textContent = `${count}건`;
      document.querySelector("#finish-work").textContent = `${finishCount}건`;

      let totalCount = count + finishCount;
      let result = 0;
      if (totalCount !== 0) result = (finishCount / totalCount) * 100;

      document.querySelector("#finish-percent").textContent = `${Math.floor(
        result
      )}%`;
    }

    // 전체 선택/해제 toggle
    function toggleChkAll(checked) {
      const chkItems = document.querySelectorAll('input[name="chk"]');
      chkItems.forEach((item) => {
        item.checked = checked;
      });
    }

    // 체크박스 상태 체크
    function undateCheckbox() {
      const chkItems = document.querySelectorAll('input[name="chk"]');
      const totalChkLength = chkItems.length;
      const currChkLength = [...chkItems].filter((chk) => chk.checked).length;
      if (totalChkLength === currChkLength && !currChkLength === 0) {
        document.querySelector("#chkAll").checked = true;
      } else {
        document.querySelector("#chkAll").checked = false;
      }
    }

    // enter
    const enterKey = (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        renderList();
      }
    };
  </script>
</html>
